"use client";

import Link from "next/link";
import { createPageUrl } from "@/utils";
import { 
  LayoutDashboard, 
  Target, 
  Sparkles, 
  BookOpen,
  Menu,
  Bot,
  MessageSquare
} from "lucide-react";
import useAppLevelAuth from "@/hooks/useAppLevelAuth";
import React from 'react';
import {
  Sidebar,
  SidebarContent,
  SidebarFooter,
  SidebarGroup,
  SidebarHeader,
  SidebarInset,
  SidebarMenu,
  SidebarMenuButton,
  SidebarMenuItem,
  SidebarProvider,
  SidebarTrigger,
} from "@/components/ui/sidebar";
import { usePathname } from "next/navigation";
import { Button } from "@/components/ui/button";
import { Card } from "@/components/ui/card";

interface LayoutProps {
  children: React.ReactNode;
  currentPageName?: string;
}

export default function Layout({ children, currentPageName }: LayoutProps) {
  const { isLoggedIn } = useAppLevelAuth();
  const pathname = usePathname();

  if (currentPageName === "Landing") {
    return <>{children}</>;
  }

  const navigation = [
    { name: "Dashboard", path: "Dashboard", icon: LayoutDashboard },
    { name: "My Skills", path: "Skills", icon: Sparkles },
    { name: "My Goals", path: "Goals", icon: Target },
    { name: "Recommender", path: "Recommender", icon: BookOpen },
    { name: "Chatbot", path: "Chatbot", icon: MessageSquare },
  ];

  const getCurrentPage = () => {
    if (currentPageName) return currentPageName;
    const path = pathname?.replace('/', '') || 'Dashboard';
    return path === '' ? 'Dashboard' : path;
  };

  const currentPage = getCurrentPage();

  return (
    <SidebarProvider>
      <Sidebar>
        <SidebarHeader className="p-4">
          <div className="flex items-center gap-3">
            <img src="https://storage.googleapis.com/space-apps-assets/store_x4fRElIa0n/Hjziagbs4F-skill.jpg" alt="SkillSet Mentor Logo" className="h-10 w-10 rounded-xl" />
            <div className="grid flex-1 text-left text-sm leading-tight">
              <span className="truncate font-bold text-lg text-sidebar-foreground">SkillSet Mentor</span>
            </div>
          </div>
        </SidebarHeader>
        
        <SidebarContent className="p-4">
          <SidebarMenu>
            {navigation.map((item) => {
              const Icon = item.icon;
              const isActive = isLoggedIn && currentPage === item.path;
              return (
                <SidebarMenuItem key={item.name}>
                  <SidebarMenuButton 
                    asChild={isLoggedIn}
                    isActive={isActive}
                    disabled={!isLoggedIn}
                  >
                    {isLoggedIn ? (
                      <Link href={createPageUrl(item.path)} className="flex items-center gap-3">
                        <Icon className="h-5 w-5 flex-shrink-0" />
                        <span>{item.name}</span>
                      </Link>
                    ) : (
                      <div className="flex items-center gap-3">
                        <Icon className="h-5 w-5 flex-shrink-0" />
                        <span>{item.name}</span>
                      </div>
                    )}
                  </SidebarMenuButton>
                </SidebarMenuItem>
              );
            })}
          </SidebarMenu>
        </SidebarContent>
        
        <SidebarFooter className="p-4">
          {!isLoggedIn && (
            <div className="space-y-2">
              <Button asChild className="w-full">
                <Link href={createPageUrl('login')}>Sign In</Link>
              </Button>
              <Button asChild variant="secondary" className="w-full">
                <Link href={createPageUrl('signup')}>Create Account</Link>
              </Button>
            </div>
          )}
        </SidebarFooter>
      </Sidebar>
      
      <SidebarInset>
        <header className="sticky top-0 z-40 flex h-16 shrink-0 items-center gap-2 border-b bg-background px-4 md:hidden">
          <SidebarTrigger>
            <Menu className="h-5 w-5" />
          </SidebarTrigger>
          <div className="flex items-center gap-2 ml-2">
            <img src="https://storage.googleapis.com/space-apps-assets/store_x4fRElIa0n/Hjziagbs4F-skill.jpg" alt="SkillSet Mentor Logo" className="h-8 w-8 rounded-lg" />
            <h1 className="text-lg font-bold">SkillSet Mentor</h1>
          </div>
        </header>
        
        <main className="flex-1 p-4 md:p-6 lg:p-8 bg-muted/40">
          {!isLoggedIn ? (
            <div className="flex flex-1 items-center justify-center h-full">
              <div className="max-w-md w-full text-center">
                <Card className="p-8">
                  <div className="inline-flex items-center justify-center w-16 h-16 rounded-full bg-primary text-primary-foreground mb-6 shadow-lg">
                    <Bot className="h-8 w-8" />
                  </div>
                  <h1 className="text-3xl font-bold text-foreground mb-3">Welcome to SkillSet Mentor</h1>
                  <p className="text-muted-foreground text-base">Your personal AI career advisor. Please sign in to get started.</p>
                </Card>
              </div>
            </div>
          ) : (
            children
          )}
        </main>
      </SidebarInset>
    </SidebarProvider>
  );
}